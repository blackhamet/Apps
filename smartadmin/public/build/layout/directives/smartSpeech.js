define(["layout/module","jquery"],function(a,b){"use strict";b.root_=b("body");var c=window;b.sound_path="sound/",b.sound_on=!0,debugState=!1,debugStyle="font-weight: bold; color: #00f;",debugStyle_green="font-weight: bold; font-style:italic; color: #46C246;",debugStyle_red="font-weight: bold; color: #ed1c24;",debugStyle_warning="background-color:yellow",debugStyle_success="background-color:green; font-weight:bold; color:#fff;",debugStyle_error="background-color:#ed1c24; font-weight:bold; color:#fff;",voice_command=!0,voice_command_auto=!1;var d="en-US",e=!1;if(voice_command)var f={"show dashboard":function(){window.location.hash="dashboard"},"show inbox":function(){window.location.hash="inbox"},"show graphs":function(){window.location.hash="graphs/flot"},"show flotchart":function(){window.location.hash="graphs/flot"},"show morris chart":function(){window.location.hash="graphs/morris"},"show inline chart":function(){window.location.hash="graphs/inline-charts"},"show dygraphs":function(){window.location.hash="graphs/dygraphs"},"show tables":function(){window.location.hash="tables/table"},"show data table":function(){window.location.hash="tables/datatable"},"show jquery grid":function(){window.location.hash="tables/jqgrid"},"show form":function(){window.location.hash="forms/form-elements"},"show form layouts":function(){window.location.hash="forms/form-templates"},"show form validation":function(){window.location.hash="forms/validation"},"show form elements":function(){window.location.hash="forms/bootstrap-forms"},"show form plugins":function(){window.location.hash="forms/plugins"},"show form wizards":function(){window.location.hash="forms/wizards"},"show bootstrap editor":function(){window.location.hash="forms/other-editors"},"show dropzone":function(){window.location.hash="forms/dropzone"},"show image cropping":function(){window.location.hash="forms/image-editor"},"show general elements":function(){window.location.hash="ui/general-elements"},"show buttons":function(){window.location.hash="ui/buttons"},"show fontawesome":function(){window.location.hash="ui/icons/fa"},"show glyph icons":function(){window.location.hash="ui/icons/glyph"},"show flags":function(){window.location.hash="ui/icons/flags"},"show grid":function(){window.location.hash="ui/grid"},"show tree view":function(){window.location.hash="ui/treeview"},"show nestable lists":function(){window.location.hash="ui/nestable-list"},"show jquery U I":function(){window.location.hash="ui/jqui"},"show typography":function(){window.location.hash="ui/typography"},"show calendar":function(){window.location.hash="calendar"},"show widgets":function(){window.location.hash="widgets"},"show gallery":function(){window.location.hash="gallery"},"show maps":function(){window.location.hash="gmap-xml"},"go back":function(){history.back(1)},"scroll up":function(){b("html, body").animate({scrollTop:0},100)},"scroll down":function(){b("html, body").animate({scrollTop:b(document).height()},100)},"hide navigation":function(){b(":root").hasClass("container")&&!b(":root").hasClass("menu-on-top")?b("span.minifyme").trigger("click"):b("#hide-menu > span > a").trigger("click")},"show navigation":function(){b(":root").hasClass("container")&&!b(":root").hasClass("menu-on-top")?b("span.minifyme").trigger("click"):b("#hide-menu > span > a").trigger("click")},mute:function(){b.sound_on=!1,b.smallBox({title:"MUTE",content:"All sounds have been muted!",color:"#a90329",timeout:4e3,icon:"fa fa-volume-off"})},"sound on":function(){b.sound_on=!0,b.speechApp.playConfirmation(),b.smallBox({title:"UNMUTE",content:"All sounds have been turned on!",color:"#40ac2b",sound_file:"voice_alert",timeout:5e3,icon:"fa fa-volume-up"})},stop:function(){smartSpeechRecognition.abort(),b(":root").removeClass("voice-command-active"),b.smallBox({title:"VOICE COMMAND OFF",content:"Your voice commands has been successfully turned off. Click on the <i class='fa fa-microphone fa-lg fa-fw'></i> icon to turn it back on.",color:"#40ac2b",sound_file:"voice_off",timeout:8e3,icon:"fa fa-microphone-slash"}),b("#speech-btn .popover").is(":visible")&&b("#speech-btn .popover").fadeOut(250)},help:function(){b("#voiceModal").removeData("modal").modal({remote:"app/layout/partials/voice-commands.tpl.html",show:!0}),b("#speech-btn .popover").is(":visible")&&b("#speech-btn .popover").fadeOut(250)},"got it":function(){b("#voiceModal").modal("hide")},logout:function(){b.speechApp.stop(),window.location=b("#logout > span > a").attr("href")}};var g=c.SpeechRecognition||c.webkitSpeechRecognition||c.mozSpeechRecognition||c.msSpeechRecognition||c.oSpeechRecognition;b.speechApp=function(a){return a.start=function(){smartSpeechRecognition.addCommands(f),smartSpeechRecognition?(smartSpeechRecognition.start(),b.root_.addClass("voice-command-active"),b.speechApp.playON(),e&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")},a.stop=function(){smartSpeechRecognition&&(smartSpeechRecognition.abort(),b.root_.removeClass("voice-command-active"),b.speechApp.playOFF(),e&&localStorage.setItem("sm-setautovoice","false"),b("#speech-btn .popover").is(":visible")&&b("#speech-btn .popover").fadeOut(250))},a.playON=function(){var a=document.createElement("audio");navigator.userAgent.match("Firefox/")?a.setAttribute("src",b.sound_path+"voice_on.ogg"):a.setAttribute("src",b.sound_path+"voice_on.mp3"),a.addEventListener("load",function(){a.play()},!0),b.sound_on&&(a.pause(),a.play())},a.playOFF=function(){var a=document.createElement("audio");navigator.userAgent.match("Firefox/")?a.setAttribute("src",b.sound_path+"voice_off.ogg"):a.setAttribute("src",b.sound_path+"voice_off.mp3"),b.get(),a.addEventListener("load",function(){a.play()},!0),b.sound_on&&(a.pause(),a.play())},a.playConfirmation=function(){var a=document.createElement("audio");navigator.userAgent.match("Firefox/")?a.setAttribute("src",b.sound_path+"voice_alert.ogg"):a.setAttribute("src",b.sound_path+"voice_alert.mp3"),b.get(),a.addEventListener("load",function(){a.play()},!0),b.sound_on&&(a.pause(),a.play())},a}({}),function(a){if(!g)return c.smartSpeechRecognition=null,a;var e,f,h=[],i={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},j=0,k=/\s*\((.*?)\)\s*/g,l=/(\(\?:[^)]+\))\?/g,m=/(\(\?)?:\w+/g,n=/\*\w+/g,o=/[\-{}\[\]+?.,\\\^$|#]/g,p=function(a){return a=a.replace(o,"\\$&").replace(k,"(?:$1)?").replace(m,function(a,b){return b?a:"([^\\s]+)"}).replace(n,"(.*?)").replace(l,"\\s*$1?\\s*"),new RegExp("^"+a+"$","i")},q=function(a){a.forEach(function(a){a.callback.apply(a.context)})},r=function(){s()||c.smartSpeechRecognition.init({},!1)},s=function(){return e!==a};c.smartSpeechRecognition={init:function(k,l){l=l===a?!0:!!l,e&&e.abort&&e.abort(),e=new g,e.maxAlternatives=5,e.continuous=!0,e.lang=d||"en-US",e.onstart=function(){q(i.start),debugState&&(c.console.log("%c âœ” SUCCESS: User allowed access the microphone service to start ",debugStyle_success),c.console.log("Language setting is set to: "+e.lang,debugStyle)),b.root_.removeClass("service-not-allowed"),b.root_.addClass("service-allowed")},e.onerror=function(a){switch(q(i.error),a.error){case"network":q(i.errorNetwork);break;case"not-allowed":case"service-not-allowed":f=!1,b.root_.removeClass("service-allowed"),b.root_.addClass("service-not-allowed"),debugState&&c.console.log("%c WARNING: Microphone was not detected (either user denied access or it is not installed properly) ",debugStyle_warning),q((new Date).getTime()-j<200?i.errorPermissionBlocked:i.errorPermissionDenied)}},e.onend=function(){if(q(i.end),f){var a=(new Date).getTime()-j;1e3>a?setTimeout(c.smartSpeechRecognition.start,1e3-a):c.smartSpeechRecognition.start()}},e.onresult=function(a){q(i.result);for(var d,e=a.results[a.resultIndex],f=0;f<e.length;f++){d=e[f].transcript.trim(),debugState&&c.console.log("Speech recognized: %c"+d,debugStyle);for(var g=0,j=h.length;j>g;g++){var k=h[g].command.exec(d);if(k){var l=k.slice(1);debugState&&(c.console.log("command matched: %c"+h[g].originalPhrase,debugStyle),l.length&&c.console.log("with parameters",l)),h[g].callback.apply(this,l),q(i.resultMatch);var m=["sound on","mute","stop"];return m.indexOf(h[g].originalPhrase)<0&&(b.smallBox({title:h[g].originalPhrase,content:"loading...",color:"#333",sound_file:"voice_alert",timeout:2e3}),b("#speech-btn .popover").is(":visible")&&b("#speech-btn .popover").fadeOut(250)),!0}}}return q(i.resultNoMatch),b.smallBox({title:'Error: <strong> " '+d+' " </strong> no match found!',content:"Please speak clearly into the microphone",color:"#a90329",timeout:5e3,icon:"fa fa-microphone"}),b("#speech-btn .popover").is(":visible")&&b("#speech-btn .popover").fadeOut(250),!1},l&&(h=[]),k.length&&this.addCommands(k)},start:function(b){r(),b=b||{},f=b.autoRestart!==a?!!b.autoRestart:!0,j=(new Date).getTime(),e.start()},abort:function(){f=!1,s&&e.abort()},debug:function(a){debugState=arguments.length>0?!!a:!0},setLanguage:function(a){r(),e.lang=a},addCommands:function(a){var b,d;r();for(var e in a)if(a.hasOwnProperty(e)){if(b=c[a[e]]||a[e],"function"!=typeof b)continue;d=p(e),h.push({command:d,callback:b,originalPhrase:e})}debugState&&c.console.log("Commands successfully loaded: %c"+h.length,debugStyle)},removeCommands:function(b){return b===a?void(h=[]):(b=Array.isArray(b)?b:[b],void(h=h.filter(function(a){for(var c=0;c<b.length;c++)if(b[c]===a.originalPhrase)return!1;return!0})))},addCallback:function(b,d,e){if(i[b]!==a){var f=c[d]||d;"function"==typeof f&&i[b].push({callback:f,context:e||this})}}}}.call(this);var h=function(){smartSpeechRecognition.addCommands(f),smartSpeechRecognition?(smartSpeechRecognition.start(),b.root_.addClass("voice-command-active"),e&&localStorage.setItem("sm-setautovoice","true")):alert("speech plugin not loaded")};g&&voice_command&&"true"==localStorage.getItem("sm-setautovoice")&&h(),g&&voice_command_auto&&voice_command&&h(),a.registerDirective("speechRecognition",["$log",function(){var a=function(a,c){if(g){var d=b('<div class="modal fade" id="voiceModal" tabindex="-1" role="dialog" aria-labelledby="remoteModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"></div></div></div>');d.appendTo("body"),c.on("click",function(a){b.root_.hasClass("voice-command-active")?b.speechApp.stop():(b.speechApp.start(),b("#speech-btn .popover").fadeIn(350)),a.preventDefault()}),b(document).mouseup(function(a){b("#speech-btn .popover").is(a.target)||0!==b("#speech-btn .popover").has(a.target).length||b("#speech-btn .popover").fadeOut(250)}),b("#speech-help-btn").on("click",function(){f.help()})}else b("#speech-btn").addClass("display-none")};return{restrict:"AE",link:a}}])});